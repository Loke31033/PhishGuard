<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Email Details - PhishGuard</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    h1, h2 { text-align: center; }
    .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
    .section { margin-bottom: 20px; }
    pre { background: #eee; padding: 10px; border-radius: 4px; overflow-x: auto; }
    
    /* Risk Colors */
    .risk-safe { color: green; font-weight: bold; }
    .risk-suspicious { color: orange; font-weight: bold; }
    .risk-high { color: red; font-weight: bold; }

    /* URLs & Attachments */
    .url-safe, .attachment-safe { color: green; }
    .url-suspicious, .attachment-suspicious { color: orange; font-weight: bold; }
    .url-risky, .attachment-risky { color: red; font-weight: bold; }

    /* Buttons */
    .btn-back, .btn-download { display: inline-block; padding: 6px 12px; color: #fff; text-decoration: none; border-radius: 4px; margin-right: 5px; font-size: 14px; }
    .btn-back { background: #007BFF; }
    .btn-back:hover { background: #0056b3; }
    .btn-download { background: #28a745; }
    .btn-download:hover { background: #1e7e34; }

    /* Collapsible sections */
    .collapsible {
      cursor: pointer;
      padding: 10px;
      background: #eee;
      border-radius: 4px;
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
    }
    .collapsible::after {
      content: '▼';
      font-size: 12px;
      transition: transform 0.3s;
    }
    .collapsible.active::after {
      transform: rotate(-180deg);
    }
    .content {
      display: none;
      padding: 10px 15px;
      border-left: 3px solid #007BFF;
      background: #fafafa;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Email Details</h1>
    <div class="section">
      <a href="{{ url_for('dashboard') }}" class="btn-back">← Back to Dashboard</a>
      <a href="{{ url_for('download_email_json', email_id=email.id) }}" class="btn-download">Download JSON</a>
    </div>

    <div class="section">
      <h2>Basic Info</h2>
      <p><strong>From:</strong> {{ email.from }}</p>
      <p><strong>To:</strong> {{ email.to }}</p>
      <p><strong>Subject:</strong> {{ email.subject }}</p>
      <p><strong>Date:</strong> {{ email.date }}</p>
      <p><strong>Risk Level:</strong>
        {% if email.risk_level == 'Safe' %}
          <span class="risk-safe">{{ email.risk_level }}</span>
        {% elif email.risk_level == 'Suspicious' %}
          <span class="risk-suspicious">{{ email.risk_level }}</span>
        {% else %}
          <span class="risk-high">{{ email.risk_level }}</span>
        {% endif %}
      </p>
    </div>

    <!-- Collapsible Sections -->
    <div class="section">
      <div class="collapsible">SPF/DKIM/DMARC</div>
      <div class="content">
        SPF: {{ email.data.phishing_analysis.spf_dkim_dmarc.spf }}<br>
        DKIM: {{ email.data.phishing_analysis.spf_dkim_dmarc.dkim }}<br>
        DMARC: {{ email.data.phishing_analysis.spf_dkim_dmarc.dmarc }}
      </div>
    </div>

    <div class="section">
      <div class="collapsible">URLs Detected</div>
      <div class="content">
        {% for u in email.data.phishing_analysis.urls_detected %}
          {% if u.risk == 'Safe' %}
            <span class="url-safe">{{ u.url }}</span><br>
          {% elif u.risk == 'Suspicious' %}
            <span class="url-suspicious">{{ u.url }} ({{ u.risk }})</span><br>
          {% else %}
            <span class="url-risky">{{ u.url }} ({{ u.risk }})</span><br>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <div class="section">
      <div class="collapsible">Attachments</div>
      <div class="content">
        {% for a in email.data.phishing_analysis.attachments %}
          {% if a.risk == 'Safe' %}
            <span class="attachment-safe">{{ a.filename }}</span><br>
          {% elif a.risk == 'Suspicious' %}
            <span class="attachment-suspicious">{{ a.filename }} ({{ a.risk }})</span><br>
          {% else %}
            <span class="attachment-risky">{{ a.filename }} ({{ a.risk }})</span><br>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <div class="section">
      <div class="collapsible">Suspicious Keywords</div>
      <div class="content">
        <pre>{{ email.data.phishing_analysis.suspicious_keywords | join(', ') }}</pre>
      </div>
    </div>

    <div class="section">
      <div class="collapsible">Email Body</div>
      <div class="content">
        <pre>{{ email.data.body_text }}</pre>
      </div>
    </div>

    <div class="section">
      <div class="collapsible">Headers</div>
      <div class="content">
        <pre>{{ email.data.headers | tojson(indent=2) }}</pre>
      </div>
    </div>
  </div>

<script>
var coll = document.getElementsByClassName("collapsible");
for (var i=0; i<coll.length; i++){
  coll[i].addEventListener("click", function(){
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    content.style.display = (content.style.display === "block") ? "none" : "block";
  });
}
</script>
</body>
</html>
